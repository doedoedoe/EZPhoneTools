<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Phone Cleaner</title>
</head>
<body style="font-family: sans-serif; padding: 20px; max-width: 900px;">
  <h3>Phone Cleaner (Auto)</h3>

  <div style="display:flex; gap:20px; flex-wrap:wrap;">
    <label><input type="checkbox" id="keep10" /> Keep only last 10 digits</label>
    <label><input type="checkbox" id="formatPretty" /> Format as (XXX) XXX-XXXX</label>
    <label><input type="checkbox" id="dropEmpty" checked /> Drop empty lines</label>
    <label><input type="checkbox" id="dedupe" /> Remove duplicates</label>
    <label><input type="checkbox" id="autocopy" checked /> Auto-copy output</label>
  </div>

  <div style="display:grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-top: 14px;">
    <div>
      <p style="margin: 0 0 6px 0;">Input (paste anything):</p>
      <textarea id="input" rows="14" style="width:100%; font-size:14px;"
        placeholder="765.932.2005, 765.932.2994 / 317.462.6852"></textarea>
      <div style="margin-top: 8px; display:flex; gap: 10px; flex-wrap:wrap;">
        <button id="clearBtn">Clear</button>
        <span id="status" style="opacity:0.8;"></span>
      </div>
    </div>

    <div>
      <p style="margin: 0 0 6px 0;">Output (one per line):</p>
      <textarea id="output" rows="14" style="width:100%; font-size:14px;" readonly></textarea>
    </div>
  </div>

<script>
const el = (id) => document.getElementById(id);

function pretty10(d) {
  if (d.length !== 10) return d;
  return `(${d.slice(0,3)}) ${d.slice(3,6)}-${d.slice(6)}`;
}

function splitIntoPieces(text) {
  // Split on newlines, commas, semicolons, tabs, pipes
  // Do NOT split on slash or dash â€” needed for range detection
  return text.split(/[\r\n,;\t|]+/g);
}

function toPhoneDigits(str) {
  const digits = (str || "").replace(/\D/g, "");
  if (!digits) return "";
  if (digits.length === 10) return digits;
  if (digits.length === 11 && digits.startsWith("1")) return digits.slice(1);
  if (digits.length > 10) return digits.slice(-10);
  return "";
}

// Detect lines like "7659327000 - 7659327099" or "765-932-7000 - 765-932-7099"
// Returns an array of digit strings if valid range, otherwise null.
// Extract all 10-digit phone numbers from a string
function extractAllPhoneNumbers(piece) {
  const matches = piece.match(/\d{7,}/g) || [];
  return matches.map(m => toPhoneDigits(m)).filter(Boolean);
}

// If a line contains exactly two phone numbers, treat it as a range.
// Handles prefixes like "DID range - 7659327000 - 7659327099"
function tryExpandRange(piece) {
  const nums = extractAllPhoneNumbers(piece);
  if (nums.length !== 2) return null;

  const s = parseInt(nums[0], 10);
  const e = parseInt(nums[1], 10);

  // Must be a forward range and not absurdly large
  if (e <= s || (e - s) > 10000) return null;

  const results = [];
  for (let n = s; n <= e; n++) {
    results.push(String(n).padStart(10, "0"));
  }
  return results;
}

function recompute() {
  const keep10 = el("keep10").checked;
  const pretty = el("formatPretty").checked;
  const dropEmpty = el("dropEmpty").checked;
  const dedupe = el("dedupe").checked;

  const pieces = splitIntoPieces(el("input").value);

  let outList = [];
  for (const p of pieces) {
    const trimmed = p.trim();
    // First try to expand as a range (e.g. "7659327000 - 7659327099")
    const expanded = tryExpandRange(trimmed);
    if (expanded) {
      let exp = expanded;
      if (keep10) exp = exp.map(d => d.slice(-10));
      outList.push(...exp);
      continue;
    }
    // Otherwise treat as a single number
    let d = toPhoneDigits(trimmed);
    if (!d) continue;
    if (keep10) d = d.slice(-10);
    outList.push(d);
  }

  if (pretty) outList = outList.map(pretty10);

  if (dropEmpty) outList = outList.filter(x => x.length > 0);

  if (dedupe) {
    const seen = new Set();
    outList = outList.filter(x => (seen.has(x) ? false : (seen.add(x), true)));
  }

  const out = outList.join("\n");
  el("output").value = out;

  if (el("autocopy").checked && out.length > 0) {
    navigator.clipboard.writeText(out).then(() => {
      el("status").textContent = "Copied!";
      clearTimeout(window.__copyT);
      window.__copyT = setTimeout(() => el("status").textContent = "", 800);
    }).catch(() => {
      el("status").textContent = "Clipboard blocked (browser)";
    });
  } else {
    el("status").textContent = "";
  }
}

["input","keep10","formatPretty","dropEmpty","dedupe","autocopy"]
  .forEach(id => el(id).addEventListener(id === "input" ? "input" : "change", recompute));

el("clearBtn").addEventListener("click", () => {
  el("input").value = "";
  el("output").value = "";
  el("status").textContent = "";
});

recompute();
</script>
</body>
</html>
